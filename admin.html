<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Nupieepro | Ops</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
:root{--bg:#0f0732;--card:rgba(255,255,255,0.05);--border:rgba(255,255,255,0.1);--orange:#f85900;--green:#10b981;--red:#ef4444}*{box-sizing:border-box;margin:0;padding:0;font-family:'Plus Jakarta Sans',sans-serif}body{background:var(--bg);color:#fff;min-height:100vh;padding-bottom:60px}.navbar{background:rgba(15,7,50,0.95);border-bottom:1px solid var(--border);padding:15px 20px;position:sticky;top:0;z-index:100;display:flex;justify-content:space-between;align-items:center}.brand{display:flex;align-items:center;gap:10px;font-weight:800;font-size:1.1rem}.brand img{width:40px;border-radius:50%;border:2px solid var(--orange)}.tabs-container{display:flex;justify-content:center;gap:10px;margin-top:20px;padding:0 10px}.tab-btn{background:var(--card);border:1px solid var(--border);color:#aaa;padding:12px 20px;border-radius:12px;cursor:pointer;font-weight:700;transition:.3s;display:flex;align-items:center;gap:8px}.tab-btn.active{background:var(--orange);color:#fff;border-color:var(--orange)}.view{display:none;max-width:1200px;margin:25px auto;padding:0 20px;animation:fade .4s}.view.active{display:block}@keyframes fade{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.event-layout{display:grid;grid-template-columns:300px 1fr;gap:20px}@media(max-width:900px){.event-layout{grid-template-columns:1fr}}.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:20px}.event-item{padding:15px;border-bottom:1px solid var(--border);cursor:pointer;transition:.2s;position:relative}.event-item:hover{background:rgba(255,255,255,0.05)}.event-item.selected{background:rgba(248,89,0,0.1);border-left:4px solid var(--orange)}.badge-live{position:absolute;top:15px;right:10px;background:var(--green);color:#004d2e;font-size:.6rem;padding:2px 6px;border-radius:4px;font-weight:800}.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:15px}.full{grid-column:1/-1}label{font-size:.7rem;text-transform:uppercase;font-weight:700;opacity:.6;display:block;margin-bottom:5px}input,select,textarea{width:100%;padding:12px;background:rgba(0,0,0,0.3);border:1px solid var(--border);border-radius:10px;color:#fff;margin-bottom:10px}textarea{height:80px;resize:vertical}.toolbar{display:flex;gap:10px;margin-top:20px;border-top:1px solid var(--border);padding-top:20px}.btn{padding:14px;border-radius:10px;border:none;font-weight:800;cursor:pointer;flex:1;transition:.3s;display:flex;align-items:center;justify-content:center;gap:8px}.btn-save{background:var(--orange);color:#fff}.btn-new{background:var(--green);color:#fff}.btn-del{background:rgba(239,68,68,0.2);color:var(--red);border:1px solid rgba(239,68,68,0.4);flex:.3}.btn-active{background:rgba(255,255,255,0.1);color:#fff;border:1px solid var(--border)}.btn-active.is-live{background:var(--green);color:#004d2e;cursor:default}.table-box{overflow-x:auto;border:1px solid var(--border);border-radius:16px;margin-top:15px}table{width:100%;border-collapse:collapse;min-width:800px}th{text-align:left;padding:15px;background:rgba(255,255,255,0.05);font-size:.8rem}td{padding:15px;border-bottom:1px solid var(--border);font-size:.9rem}.pill{padding:4px 10px;border-radius:20px;font-size:.7rem;font-weight:700;cursor:pointer;width:100px;text-align:center;display:inline-block}.pill.P{background:rgba(16,185,129,0.2);color:var(--green);border:1px solid var(--green)}.pill.I{background:rgba(255,255,255,0.1);color:#ccc;border:1px solid var(--border)}@media(max-width:600px){.form-grid{grid-template-columns:1fr}.toolbar{flex-direction:column}thead{display:none}tr{display:flex;flex-direction:column;background:rgba(255,255,255,0.03);margin-bottom:10px;padding:15px;border-radius:15px}td{padding:5px 0;border:none}}
</style>
</head>
<body>
<div class="navbar"><div class="brand"><img src="https://i.ibb.co/FkYzNVcT/download.jpg"> NUPI OPS</div><button onclick="carregar()" style="background:none;border:none;color:#fff;font-size:1.2rem"><i class="fa-solid fa-rotate"></i></button></div>
<div class="tabs-container"><div class="tab-btn active" onclick="go('dashboard')"><i class="fa-solid fa-calendar-gear"></i> Eventos</div><div class="tab-btn" onclick="go('checkin')"><i class="fa-solid fa-users-viewfinder"></i> Credenciamento</div></div>
<div id="view-dashboard" class="view active"><div class="event-layout"><div class="card" style="padding:0;overflow:hidden;max-height:500px;overflow-y:auto"><div style="padding:15px;background:rgba(255,255,255,0.05);font-weight:800;display:flex;justify-content:space-between;align-items:center">MEUS EVENTOS<button onclick="novoEvento()" style="background:var(--green);border:none;border-radius:50%;width:25px;height:25px;color:#fff;cursor:pointer">+</button></div><div id="lista-eventos"></div></div><div class="card" id="editor-area" style="display:none"><h3 id="editor-titulo" style="margin-bottom:20px;color:var(--orange)">Editando Evento</h3><input type="hidden" id="ev-id"><div class="form-grid"><div class="full"><label>Nome do Evento</label><input type="text" id="ev-nome"></div><div class="full"><label>Descrição</label><textarea id="ev-desc"></textarea></div><div><label>Data</label><input type="text" id="ev-data" placeholder="dd/mm/aaaa"></div><div><label>Horário</label><input type="text" id="ev-hora"></div><div><label>Palestrante</label><input type="text" id="ev-palestrante"></div><div><label>Formato</label><select id="ev-formato"><option>Online (Google Meet)</option><option>Online (Youtube)</option><option>Presencial (Auditório)</option><option>Híbrido</option></select></div><div><label>Vagas</label><input type="number" id="ev-vagas"></div><div><label>Status</label><select id="ev-status"><option value="ABERTO">ABERTO</option><option value="FECHADO">FECHADO</option></select></div><div class="full"><label>Cor</label><input type="color" id="ev-cor" style="width:100%;height:40px;cursor:pointer"></div></div><div class="toolbar"><button class="btn btn-del" onclick="excluirEvento()"><i class="fa-solid fa-trash"></i></button><button class="btn btn-active" id="btn-ativar" onclick="ativarEvento()"><i class="fa-solid fa-globe"></i> TORNAR ATIVO</button><button class="btn btn-save" onclick="salvarEvento()"><i class="fa-solid fa-floppy-disk"></i> SALVAR</button></div></div></div></div>
<div id="view-checkin" class="view"><div class="card"><div style="display:flex;gap:10px;margin-bottom:15px;flex-wrap:wrap"><select id="filtro-evento" onchange="filtrar()" style="width:200px;margin:0"><option>Carregando...</option></select><input type="text" id="busca" placeholder="Buscar..." onkeyup="filtrar()" style="flex:1;margin:0"><button onclick="baixarCSV()" style="padding:10px 20px;background:#3b82f6;color:#fff;border:none;border-radius:10px;font-weight:700;cursor:pointer">BAIXAR CSV</button></div><div style="margin-bottom:15px;font-size:.9rem">Total: <strong id="kpi-total">0</strong> | Vagas: <strong id="kpi-vagas" style="color:var(--orange)">0</strong></div><div class="table-box"><table id="tabela-checkin"><thead><tr><th>Nome/Email</th><th>Info</th><th>Status</th><th>Obs</th></tr></thead><tbody id="lista-inscritos"></tbody></table></div></div></div>
<script>
// --- AQUI ESTÁ A SUA URL NOVA ---
const API = "https://script.google.com/macros/s/AKfycbyHQG1P43Johs9NvxkaoKNELhsXagVmCammU2kCLmibsQriH7OP863nUZssCl3CNOLkoQ/exec";

let cache={eventos:[],inscritos:[]},eventoSelecionado=null;window.onload=function(){const p=new URLSearchParams(window.location.search);if(p.get("token")==="nupi2026"){carregar()}else{document.body.innerHTML='<h2 style="text-align:center;margin-top:50px">Acesso Negado</h2>'}};
function go(t){document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));document.getElementById('view-'+t).classList.add('active');event.currentTarget.classList.add('active')}
async function carregar(){const r=await fetch(API+"?action=get_admin").then(res=>res.json());cache=r;renderEventos();renderFiltro();if(eventoSelecionado)selecionarEvento(eventoSelecionado.id)}
function renderEventos(){document.getElementById('lista-eventos').innerHTML=cache.eventos.map(e=>`<div class="event-item ${eventoSelecionado?.id===e.id?'selected':''}" onclick="selecionarEvento('${e.id}')"><div style="font-weight:700">${e.nome||'Novo'}</div><div style="font-size:.7rem;opacity:.6">${e.data} - ${e.status}</div>${e.ativo?'<span class="badge-live">NO AR</span>':''}</div>`).join('')}
function selecionarEvento(id){eventoSelecionado=cache.eventos.find(e=>e.id==id);renderEventos();document.getElementById('editor-area').style.display='block';document.getElementById('ev-id').value=eventoSelecionado.id;document.getElementById('ev-nome').value=eventoSelecionado.nome;document.getElementById('ev-desc').value=eventoSelecionado.descricao;document.getElementById('ev-data').value=eventoSelecionado.data;document.getElementById('ev-hora').value=eventoSelecionado.horario;document.getElementById('ev-palestrante').value=eventoSelecionado.palestrante;document.getElementById('ev-formato').value=eventoSelecionado.formato;document.getElementById('ev-vagas').value=eventoSelecionado.vagas;document.getElementById('ev-status').value=eventoSelecionado.status;document.getElementById('ev-cor').value=eventoSelecionado.cor;const b=document.getElementById('btn-ativar');if(eventoSelecionado.ativo){b.innerHTML='<i class="fa-solid fa-check"></i> NO AR';b.classList.add('is-live')}else{b.innerHTML='<i class="fa-solid fa-globe"></i> TORNAR ATIVO';b.classList.remove('is-live')}}
function novoEvento(){eventoSelecionado={id:'',nome:'',status:'FECHADO',vagas:100,cor:'#f85900',descricao:'',data:'',horario:'',palestrante:'',formato:'Online (Google Meet)',ativo:false};document.getElementById('editor-area').style.display='block';selecionarEvento('');document.getElementById('ev-id').value=''}
async function salvarEvento(){const b=document.querySelector('.btn-save');b.innerText='...';const p=new URLSearchParams({action:'save_event',id:document.getElementById('ev-id').value,nome:document.getElementById('ev-nome').value,descricao:document.getElementById('ev-desc').value,data:document.getElementById('ev-data').value,horario:document.getElementById('ev-hora').value,palestrante:document.getElementById('ev-palestrante').value,formato:document.getElementById('ev-formato').value,vagas:document.getElementById('ev-vagas').value,status:document.getElementById('ev-status').value,cor:document.getElementById('ev-cor').value});await fetch(API,{method:'POST',body:p});Swal.fire('Salvo!','','success');b.innerHTML='SALVAR';carregar()}
async function ativarEvento(){if(!confirm("Substituir evento atual?"))return;await fetch(API,{method:'POST',body:new URLSearchParams({action:'set_active',id:eventoSelecionado.id})});Swal.fire('Ativado!','','success');carregar()}
async function excluirEvento(){if(!confirm("Excluir para sempre?"))return;await fetch(API,{method:'POST',body:new URLSearchParams({action:'delete_event',id:eventoSelecionado.id})});location.reload()}
function renderFiltro(){const s=document.getElementById('filtro-evento');s.innerHTML=cache.eventos.map(e=>`<option value="${e.nome}">${e.nome}</option>`).join('');filtrar()}
function filtrar(){const ev=document.getElementById('filtro-evento').value,t=document.getElementById('busca').value.toLowerCase();const l=cache.inscritos.filter(i=>i.evento===ev&&(i.nome.toLowerCase().includes(t)||i.email.toLowerCase().includes(t)));const c=cache.eventos.find(e=>e.nome===ev);document.getElementById('kpi-total').innerText=l.length;document.getElementById('kpi-vagas').innerText=c?Math.max(0,c.vagas-l.length):'-';document.getElementById('lista-inscritos').innerHTML=l.map(i=>`<tr><td><strong>${i.nome}</strong><br><small style="opacity:.6">${i.email}</small></td><td>${i.inst}<br><small>${i.curso}</small></td><td><span class="pill ${i.status==='PRESENTE'?'P':'I'}" onclick="mudarStatus(${i.id},'${i.status}')">${i.status}</span></td><td><input value="${i.obs}" onblur="salvarObs(${i.id},this.value)" style="background:none;border:none;border-bottom:1px solid #555;color:#fff"></td></tr>`).join('')}
async function mudarStatus(id,at){const n=at==='PRESENTE'?'INSCRITO':'PRESENTE';cache.inscritos.find(i=>i.id===id).status=n;filtrar();await fetch(API,{method:'POST',body:new URLSearchParams({action:'check_in',linha:id,status:n})})}
async function salvarObs(id,tx){await fetch(API,{method:'POST',body:new URLSearchParams({action:'check_in',linha:id,obs:tx})})}
function baixarCSV(){const ev=document.getElementById('filtro-evento').value;let l=cache.inscritos.filter(i=>i.evento===ev);let c="\uFEFFData;Nome;Email;Instituicao;Curso;Periodo;Status;Obs;Origem;Duvida\n";l.forEach(i=>c+=`${i.data};${i.nome};${i.email};${i.inst};${i.curso};${i.periodo};${i.status};${i.obs};${i.origem};${i.duvida}\n`);const a=document.createElement('a');a.href=URL.createObjectURL(new Blob([c],{type:'text/csv'}));a.download=`NUPI_${ev}.csv`;a.click()}
</script></body></html>
